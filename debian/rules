#!/usr/bin/make -f
# -*- makefile -*-

#export DH_VERBOSE=1

%:
	dh $@

override_dh_installchangelogs:
	dh_installchangelogs Changes.txt

override_dh_compress:
	dh_compress -X.txt -X.py

override_dh_auto_build:
	dh_auto_build

        # Docs should be included in release
	[ -e doc/html ]
	[ -e doc/man ]
	[ -e doc/manual.pdf ]

override_dh_install:
	# Fakeroot breaks testing
	#python setup.py test
	dh_install
	cp contrib/expire_backups.py debian/s3ql/usr/bin/expire_backups
	cp contrib/expire_backups.1 debian/s3ql/usr/share/man/man1/
	cp contrib/pcp.py debian/s3ql/usr/bin/pcp
	cp contrib/pcp.1 debian/s3ql/usr/share/man/man1/

override_dh_installdocs:
	dh_installdocs
	rm debian/s3ql/usr/share/doc/s3ql/contrib/expire_backups.py \
	   debian/s3ql/usr/share/doc/s3ql/contrib/expire_backups.1 \
	   debian/s3ql/usr/share/doc/s3ql/contrib/pcp.py \
	   debian/s3ql/usr/share/doc/s3ql/contrib/pcp.1 \
	   debian/s3ql/usr/share/doc/s3ql/html/_static/jquery.js 
	ln -sf /usr/share/javascript/jquery/jquery.js \
	   debian/s3ql/usr/share/doc/s3ql/html/_static/jquery.js


override_dh_fixperms:
	dh_fixperms
	chmod +x debian/s3ql/usr/share/doc/s3ql/contrib/*.py \
	         debian/s3ql/usr/share/doc/s3ql/contrib/*.sh

override_dh_auto_clean:
	dh_auto_clean
	rm -rf dist setup.log build 
