Comparison to other S3 storage methods


<wiki:toc max_depth="2" />

There are basically two methods to store data on Amazon S3. The first one is to implement a mapping between files and s3 objects. The second one is to use S3 as a block device for a "real" kernel filesystem like ext3 or XFS.

Naturally, for some applications one approach might be more suited than the other.

== Block based ==

Main properties of the block-based approach are:
  * The code can be kept much simpler, since no filesystem semantics have to be reimplemented
  * Caching can be left to the kernel and does not need to be done by the s3 layer.
  * Cryptography, extended attributes and other advanced features all come for free.
  * The filesystem cannot dynamically grow and shrink, since the s3 layer has no information about the usage of any block. This means that e.g. deleting a file will not result in less space occupied on S3.
  * Since the blocksize is usually rather small (e.g. 64 KB), a large number of requests is needed to store data (e.g. 16386 requests for 1 GB of data).
  * On the other hand, if one increases the blocksize, even simple operations like chmod() may result in very large network operations (although this might be mitigated by caching)
  * The kernel cache does not take into account the special nature of S3, i.e. that writing and reading is much more expensive than for an ordinary, local block device (both in terms of time and money)

A block based approach is implemented in e.g. [http://code.google.com/p/s3backer S3backer].

== File Based ==

The file oriented approach can be characterized as follows:
  * A full filesystem has to be implemented by the S3 layer
  * The s3 layer/filesystem has intimate knowledge about the structure and contents of the stored data
  * Therefore the filesystem can much better adapt to the peculiarities of S3 (e.g. it can dynamically grow and shrink, or adjust the number of requests)
  * All advanced features (cryptography, extended attributes) have to be coded in the s3 layer or they won't be available

A block based approach is implemented in S3QL and e.g. [http://code.google.com/p/s3fs s3fs].

== S3QL's Approach ==

S3QL follows the file based approach to store data on S3. This means that it has to provide the full semantics of a unix filesystem. Luckily enough, this daring complexity is reduced by a number of factors:

  * S3QL uses the [http://fuse.sourceforge.net/ FUSE] library which provides an interface with the Linux kernel and allows S3QL to run in user space. Working in user space makes the implementation much easier.

 * The FUSE library also already implements many filesystem semantics itself (most notably both user-level and internal file locking). This reduces the functionality that S3QL itself has to provide.

  * S3QL uses an embedded database engine, [http://www.sqlite.org SQLite], to manage the filesystem metadata. This significantly reduces the complexity of the S3QL code since many filesystem operations can directly be translated into SQL statements (which are then executed by SQLite)
